<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Zappy Project: Architecture du Serveur Zappy</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Zappy Project<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">Complete Zappy ecosystem: Server, AI Client &amp; GUI - EPITECH 2025</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_doc_2zappy-server.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Architecture du Serveur Zappy</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a> </p>
<h1><a class="anchor" id="autotoc_md1"></a>
Vue d'ensemble</h1>
<p>Le serveur est le cœur du projet Zappy. Il gère l'état du monde, applique les règles du jeu, et coordonne la communication entre tous les clients. Architecture <b>single-threaded</b> et <b>event-driven</b> utilisant <code>poll()</code>.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Architecture modulaire</h1>
<div class="fragment"><div class="line">server/</div>
<div class="line">├── core/               # Cœur du serveur</div>
<div class="line">│   ├── server.c       # Boucle principale</div>
<div class="line">│   ├── poll_manager.c # Gestion du multiplexing</div>
<div class="line">│   └── config.c       # Parsing des arguments</div>
<div class="line">│</div>
<div class="line">├── network/           # Module réseau</div>
<div class="line">│   ├── socket.c      # Gestion des sockets</div>
<div class="line">│   ├── client.c      # Gestion des clients</div>
<div class="line">│   ├── buffer.c      # Buffers circulaires</div>
<div class="line">│   └── protocol.c    # Parsing/Building</div>
<div class="line">│</div>
<div class="line">├── world/            # Module monde</div>
<div class="line">│   ├── map.c        # Carte toroïdale</div>
<div class="line">│   ├── tile.c       # Gestion des cases</div>
<div class="line">│   ├── resources.c  # Spawn et distribution</div>
<div class="line">│   └── vision.c     # Calcul de vision</div>
<div class="line">│</div>
<div class="line">├── game/            # Logique de jeu</div>
<div class="line">│   ├── player.c     # Gestion des joueurs</div>
<div class="line">│   ├── team.c       # Gestion des équipes</div>
<div class="line">│   ├── elevation.c  # Système d&#39;élévation</div>
<div class="line">│   └── egg.c        # Système d&#39;œufs</div>
<div class="line">│</div>
<div class="line">├── engine/          # Moteur temporel</div>
<div class="line">│   ├── time.c       # Gestion du temps</div>
<div class="line">│   ├── events.c     # Queue d&#39;événements</div>
<div class="line">│   └── actions.c    # Exécution d&#39;actions</div>
<div class="line">│</div>
<div class="line">└── commands/        # Handlers de commandes</div>
<div class="line">    ├── ai_commands.c</div>
<div class="line">    └── gui_commands.c</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3"></a>
Structures de données principales</h1>
<h2><a class="anchor" id="autotoc_md4"></a>
Structure Server</h2>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_struct" href="structserver__s.html">server_s</a> {</div>
<div class="line">    <span class="comment">/* Configuration */</span></div>
<div class="line">    <a class="code hl_struct" href="structconfig__s.html">config_t</a> <a class="code hl_variable" href="group__player.html#ga90cea11a02ccf1671445ee005295e518">config</a>;              <span class="comment">// Paramètres de lancement</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* Réseau */</span></div>
<div class="line">    <span class="keywordtype">int</span> <a class="code hl_variable" href="group__player.html#gacd8a5e3f6d6bd81398a7745c63b31ad5">listen_fd</a>;                <span class="comment">// Socket d&#39;écoute</span></div>
<div class="line">    <span class="keyword">struct </span>pollfd *<a class="code hl_variable" href="group__player.html#ga07ec46a5216c43e29b115e46780cd867">poll_fds</a>;      <span class="comment">// Array pour poll()</span></div>
<div class="line">    <span class="keywordtype">size_t</span> <a class="code hl_variable" href="group__player.html#gaf3546c9bc4e933c070a9df48bf8d101b">poll_count</a>;            <span class="comment">// Nombre de fds</span></div>
<div class="line">    <a class="code hl_struct" href="structclient__s.html">client_t</a> *<a class="code hl_variable" href="group__player.html#ga7a47e710697b5fe443d4cc06d726bc93">clients</a>;            <span class="comment">// Liste des clients</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* Monde */</span></div>
<div class="line">    <a class="code hl_struct" href="structmap__s.html">map_t</a> *<a class="code hl_variable" href="group__player.html#ga49201497525d1488a1a895d5239df3de">map</a>;                   <span class="comment">// Carte du jeu</span></div>
<div class="line">    <a class="code hl_struct" href="structteam__s.html">team_t</a> *<a class="code hl_variable" href="group__player.html#ga3488ab40b892352ee871a597f785c6f8">teams</a>;                <span class="comment">// Équipes</span></div>
<div class="line">    <span class="keywordtype">size_t</span> team_count;            </div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* Temps */</span></div>
<div class="line">    time_manager_t *time_mgr;     <span class="comment">// Gestionnaire temporel</span></div>
<div class="line">    <a class="code hl_struct" href="structevent__queue__s.html">event_queue_t</a> *<a class="code hl_variable" href="group__player.html#ga695560796331fc9d312e853fc013cd2a">events</a>;        <span class="comment">// Queue d&#39;événements</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* Pools mémoire */</span></div>
<div class="line">    pool_t *player_pool;          <span class="comment">// Pool de joueurs</span></div>
<div class="line">    pool_t *egg_pool;             <span class="comment">// Pool d&#39;œufs</span></div>
<div class="line">    pool_t *resource_pool;        <span class="comment">// Pool de ressources</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* État */</span></div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_variable" href="group__player.html#gac985a8bb72981dca6862fd7575c08ecb">running</a>;                 <span class="comment">// Flag d&#39;exécution</span></div>
<div class="line">    <a class="code hl_enumeration" href="server__old_8h.html#a4edce1ca040716922b6e4a79be4e414d">game_state_t</a> <a class="code hl_variable" href="group__player.html#ga77c386b8af6fd879dc9a1182853178ed">state</a>;           <span class="comment">// État du jeu</span></div>
<div class="line">} <a class="code hl_typedef" href="server__old_8h.html#a0d46b4d18005bd6a95dddba0e65bddf6">server_t</a>;</div>
<div class="ttc" id="agroup__player_html_ga07ec46a5216c43e29b115e46780cd867"><div class="ttname"><a href="group__player.html#ga07ec46a5216c43e29b115e46780cd867">server_s::poll_fds</a></div><div class="ttdeci">struct pollfd poll_fds[MAX_CLIENTS+1]</div><div class="ttdoc">Poll file descriptors array.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00233">server_old.h:233</a></div></div>
<div class="ttc" id="agroup__player_html_ga3488ab40b892352ee871a597f785c6f8"><div class="ttname"><a href="group__player.html#ga3488ab40b892352ee871a597f785c6f8">server_s::teams</a></div><div class="ttdeci">team_t * teams</div><div class="ttdoc">Linked list of teams.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00237">server_old.h:237</a></div></div>
<div class="ttc" id="agroup__player_html_ga49201497525d1488a1a895d5239df3de"><div class="ttname"><a href="group__player.html#ga49201497525d1488a1a895d5239df3de">server_s::map</a></div><div class="ttdeci">map_t * map</div><div class="ttdoc">Game world map.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00236">server_old.h:236</a></div></div>
<div class="ttc" id="agroup__player_html_ga695560796331fc9d312e853fc013cd2a"><div class="ttname"><a href="group__player.html#ga695560796331fc9d312e853fc013cd2a">server_s::events</a></div><div class="ttdeci">event_queue_t * events</div><div class="ttdoc">Event queue for timed actions.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00238">server_old.h:238</a></div></div>
<div class="ttc" id="agroup__player_html_ga77c386b8af6fd879dc9a1182853178ed"><div class="ttname"><a href="group__player.html#ga77c386b8af6fd879dc9a1182853178ed">server_s::state</a></div><div class="ttdeci">game_state_t state</div><div class="ttdoc">Current game state.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00240">server_old.h:240</a></div></div>
<div class="ttc" id="agroup__player_html_ga7a47e710697b5fe443d4cc06d726bc93"><div class="ttname"><a href="group__player.html#ga7a47e710697b5fe443d4cc06d726bc93">server_s::clients</a></div><div class="ttdeci">client_t * clients</div><div class="ttdoc">Linked list of connected clients.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00235">server_old.h:235</a></div></div>
<div class="ttc" id="agroup__player_html_ga90cea11a02ccf1671445ee005295e518"><div class="ttname"><a href="group__player.html#ga90cea11a02ccf1671445ee005295e518">server_s::config</a></div><div class="ttdeci">config_t config</div><div class="ttdoc">Server configuration.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00231">server_old.h:231</a></div></div>
<div class="ttc" id="agroup__player_html_gac985a8bb72981dca6862fd7575c08ecb"><div class="ttname"><a href="group__player.html#gac985a8bb72981dca6862fd7575c08ecb">server_s::running</a></div><div class="ttdeci">bool running</div><div class="ttdoc">Server running flag.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00239">server_old.h:239</a></div></div>
<div class="ttc" id="agroup__player_html_gacd8a5e3f6d6bd81398a7745c63b31ad5"><div class="ttname"><a href="group__player.html#gacd8a5e3f6d6bd81398a7745c63b31ad5">server_s::listen_fd</a></div><div class="ttdeci">int listen_fd</div><div class="ttdoc">Listening socket file descriptor.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00232">server_old.h:232</a></div></div>
<div class="ttc" id="agroup__player_html_gaf3546c9bc4e933c070a9df48bf8d101b"><div class="ttname"><a href="group__player.html#gaf3546c9bc4e933c070a9df48bf8d101b">server_s::poll_count</a></div><div class="ttdeci">size_t poll_count</div><div class="ttdoc">Number of active poll descriptors.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00234">server_old.h:234</a></div></div>
<div class="ttc" id="aserver__old_8h_html_a0d46b4d18005bd6a95dddba0e65bddf6"><div class="ttname"><a href="server__old_8h.html#a0d46b4d18005bd6a95dddba0e65bddf6">server_t</a></div><div class="ttdeci">struct server_s server_t</div><div class="ttdoc">Main server structure.</div></div>
<div class="ttc" id="aserver__old_8h_html_a4edce1ca040716922b6e4a79be4e414d"><div class="ttname"><a href="server__old_8h.html#a4edce1ca040716922b6e4a79be4e414d">game_state_t</a></div><div class="ttdeci">game_state_t</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00095">server_old.h:95</a></div></div>
<div class="ttc" id="astructclient__s_html"><div class="ttname"><a href="structclient__s.html">client_s</a></div><div class="ttdoc">Client connection.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00195">server_old.h:195</a></div></div>
<div class="ttc" id="astructconfig__s_html"><div class="ttname"><a href="structconfig__s.html">config_s</a></div><div class="ttdoc">Server configuration.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00213">server_old.h:213</a></div></div>
<div class="ttc" id="astructevent__queue__s_html"><div class="ttname"><a href="structevent__queue__s.html">event_queue_s</a></div><div class="ttdoc">Event queue.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00190">server_old.h:190</a></div></div>
<div class="ttc" id="astructmap__s_html"><div class="ttname"><a href="structmap__s.html">map_s</a></div><div class="ttdoc">Game map.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00166">server_old.h:166</a></div></div>
<div class="ttc" id="astructserver__s_html"><div class="ttname"><a href="structserver__s.html">server_s</a></div><div class="ttdoc">Main server structure.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00230">server_old.h:230</a></div></div>
<div class="ttc" id="astructteam__s_html"><div class="ttname"><a href="structteam__s.html">team_s</a></div><div class="ttdoc">Team structure.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00173">server_old.h:173</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
Structure Client</h2>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_struct" href="structclient__s.html">client_s</a> {</div>
<div class="line">    <span class="comment">/* Réseau */</span></div>
<div class="line">    <span class="keywordtype">int</span> <a class="code hl_variable" href="group__player.html#ga9babf0c4dea4b555e6b87a47f4ca98cd">fd</a>;                       <span class="comment">// File descriptor</span></div>
<div class="line">    <span class="keyword">struct </span>sockaddr_in <a class="code hl_variable" href="group__player.html#ga0462afe1661e70a0c69fa24f39387d0f">addr</a>;      <span class="comment">// Adresse IP</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* Buffers */</span></div>
<div class="line">    <a class="code hl_struct" href="structcircular__buffer__s.html">circular_buffer_t</a> *<a class="code hl_variable" href="group__player.html#ga627a2a9b037f05c6fbf6b2cd516a4db1">in_buf</a>;    <span class="comment">// Buffer d&#39;entrée</span></div>
<div class="line">    <a class="code hl_struct" href="structcircular__buffer__s.html">circular_buffer_t</a> *<a class="code hl_variable" href="group__player.html#gae0d3617a7f268f36894a9dd0af77b19b">out_buf</a>;   <span class="comment">// Buffer de sortie</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* État */</span></div>
<div class="line">    <a class="code hl_enumeration" href="server__old_8h.html#a0aebce9254debf15e4de1b373f185736">client_type_t</a> <a class="code hl_variable" href="group__player.html#ga810faa664442b062d3fd9f4ed21fda70">type</a>;           <span class="comment">// AI ou GUI</span></div>
<div class="line">    <a class="code hl_enumeration" href="server__old_8h.html#a52b6e82944b6ee741486f9c2567bd9b9">client_state_t</a> <a class="code hl_variable" href="group__player.html#gaa3abfe7054be6e34d708c28c2e0b3d7f">state</a>;         <span class="comment">// CONNECTING, CONNECTED, etc.</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* Parsing */</span></div>
<div class="line">    <span class="keywordtype">char</span> <a class="code hl_variable" href="group__player.html#ga0ffcf964ad2ba56762106c777c8257d7">partial_cmd</a>[<a class="code hl_define" href="server__old_8h.html#aab1a0d6f90722c03ed6c8a9460d6e792">CMD_MAX</a>];    <span class="comment">// Commande partielle</span></div>
<div class="line">    <span class="keywordtype">size_t</span> <a class="code hl_variable" href="group__player.html#ga3319d3c5d22dad73aa9479300ee51a48">partial_len</a>;           </div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* Jeu */</span></div>
<div class="line">    <a class="code hl_struct" href="structplayer__s.html">player_t</a> *<a class="code hl_variable" href="group__player.html#ga4d69303fabf51144650a6e2fbeaaeda2">player</a>;             <span class="comment">// Joueur associé (si AI)</span></div>
<div class="line">    <a class="code hl_struct" href="structteam__s.html">team_t</a> *<a class="code hl_variable" href="group__player.html#gaa62ade53b06062eaca591e6a94efb023">team</a>;                 <span class="comment">// Équipe (si AI)</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* Commandes */</span></div>
<div class="line">    <a class="code hl_struct" href="structcommand__queue__s.html">command_queue_t</a> *<a class="code hl_variable" href="group__player.html#gae659bbcce06f5a85869c7f7d0dad522b">cmd_queue</a>;   <span class="comment">// Queue de commandes (max 10)</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* Stats */</span></div>
<div class="line">    time_t <a class="code hl_variable" href="group__player.html#ga3c395920f88fcf5b9b405d4e1dcae0a6">connect_time</a>;          </div>
<div class="line">    <span class="keywordtype">size_t</span> <a class="code hl_variable" href="group__player.html#ga7f2013414ee74bfa9a49a3ac147228b3">bytes_sent</a>;</div>
<div class="line">    <span class="keywordtype">size_t</span> <a class="code hl_variable" href="group__player.html#ga2044ec34a83d761e51d829d92b1a23d1">bytes_received</a>;</div>
<div class="line">} <a class="code hl_typedef" href="server__old_8h.html#a7bfebc8e763f36d1870198931d6b5eb1">client_t</a>;</div>
<div class="ttc" id="agroup__player_html_ga0462afe1661e70a0c69fa24f39387d0f"><div class="ttname"><a href="group__player.html#ga0462afe1661e70a0c69fa24f39387d0f">client_s::addr</a></div><div class="ttdeci">struct sockaddr_in addr</div><div class="ttdoc">Client address.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00197">server_old.h:197</a></div></div>
<div class="ttc" id="agroup__player_html_ga0ffcf964ad2ba56762106c777c8257d7"><div class="ttname"><a href="group__player.html#ga0ffcf964ad2ba56762106c777c8257d7">client_s::partial_cmd</a></div><div class="ttdeci">char partial_cmd[CMD_MAX]</div><div class="ttdoc">Partial command buffer.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00202">server_old.h:202</a></div></div>
<div class="ttc" id="agroup__player_html_ga2044ec34a83d761e51d829d92b1a23d1"><div class="ttname"><a href="group__player.html#ga2044ec34a83d761e51d829d92b1a23d1">client_s::bytes_received</a></div><div class="ttdeci">size_t bytes_received</div><div class="ttdoc">Total bytes received.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00209">server_old.h:209</a></div></div>
<div class="ttc" id="agroup__player_html_ga3319d3c5d22dad73aa9479300ee51a48"><div class="ttname"><a href="group__player.html#ga3319d3c5d22dad73aa9479300ee51a48">client_s::partial_len</a></div><div class="ttdeci">size_t partial_len</div><div class="ttdoc">Partial command length.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00203">server_old.h:203</a></div></div>
<div class="ttc" id="agroup__player_html_ga3c395920f88fcf5b9b405d4e1dcae0a6"><div class="ttname"><a href="group__player.html#ga3c395920f88fcf5b9b405d4e1dcae0a6">client_s::connect_time</a></div><div class="ttdeci">time_t connect_time</div><div class="ttdoc">Connection timestamp.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00207">server_old.h:207</a></div></div>
<div class="ttc" id="agroup__player_html_ga4d69303fabf51144650a6e2fbeaaeda2"><div class="ttname"><a href="group__player.html#ga4d69303fabf51144650a6e2fbeaaeda2">client_s::player</a></div><div class="ttdeci">player_t * player</div><div class="ttdoc">Associated player (AI only)</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00204">server_old.h:204</a></div></div>
<div class="ttc" id="agroup__player_html_ga627a2a9b037f05c6fbf6b2cd516a4db1"><div class="ttname"><a href="group__player.html#ga627a2a9b037f05c6fbf6b2cd516a4db1">client_s::in_buf</a></div><div class="ttdeci">circular_buffer_t * in_buf</div><div class="ttdoc">Input buffer.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00198">server_old.h:198</a></div></div>
<div class="ttc" id="agroup__player_html_ga7f2013414ee74bfa9a49a3ac147228b3"><div class="ttname"><a href="group__player.html#ga7f2013414ee74bfa9a49a3ac147228b3">client_s::bytes_sent</a></div><div class="ttdeci">size_t bytes_sent</div><div class="ttdoc">Total bytes sent.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00208">server_old.h:208</a></div></div>
<div class="ttc" id="agroup__player_html_ga810faa664442b062d3fd9f4ed21fda70"><div class="ttname"><a href="group__player.html#ga810faa664442b062d3fd9f4ed21fda70">client_s::type</a></div><div class="ttdeci">client_type_t type</div><div class="ttdoc">Client type (AI/GUI)</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00200">server_old.h:200</a></div></div>
<div class="ttc" id="agroup__player_html_ga9babf0c4dea4b555e6b87a47f4ca98cd"><div class="ttname"><a href="group__player.html#ga9babf0c4dea4b555e6b87a47f4ca98cd">client_s::fd</a></div><div class="ttdeci">int fd</div><div class="ttdoc">Socket file descriptor.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00196">server_old.h:196</a></div></div>
<div class="ttc" id="agroup__player_html_gaa3abfe7054be6e34d708c28c2e0b3d7f"><div class="ttname"><a href="group__player.html#gaa3abfe7054be6e34d708c28c2e0b3d7f">client_s::state</a></div><div class="ttdeci">client_state_t state</div><div class="ttdoc">Connection state.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00201">server_old.h:201</a></div></div>
<div class="ttc" id="agroup__player_html_gaa62ade53b06062eaca591e6a94efb023"><div class="ttname"><a href="group__player.html#gaa62ade53b06062eaca591e6a94efb023">client_s::team</a></div><div class="ttdeci">team_t * team</div><div class="ttdoc">Associated team (AI only)</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00205">server_old.h:205</a></div></div>
<div class="ttc" id="agroup__player_html_gae0d3617a7f268f36894a9dd0af77b19b"><div class="ttname"><a href="group__player.html#gae0d3617a7f268f36894a9dd0af77b19b">client_s::out_buf</a></div><div class="ttdeci">circular_buffer_t * out_buf</div><div class="ttdoc">Output buffer.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00199">server_old.h:199</a></div></div>
<div class="ttc" id="agroup__player_html_gae659bbcce06f5a85869c7f7d0dad522b"><div class="ttname"><a href="group__player.html#gae659bbcce06f5a85869c7f7d0dad522b">client_s::cmd_queue</a></div><div class="ttdeci">command_queue_t * cmd_queue</div><div class="ttdoc">Command queue.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00206">server_old.h:206</a></div></div>
<div class="ttc" id="aserver__old_8h_html_a0aebce9254debf15e4de1b373f185736"><div class="ttname"><a href="server__old_8h.html#a0aebce9254debf15e4de1b373f185736">client_type_t</a></div><div class="ttdeci">client_type_t</div><div class="ttdoc">Client connection types.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00082">server_old.h:82</a></div></div>
<div class="ttc" id="aserver__old_8h_html_a52b6e82944b6ee741486f9c2567bd9b9"><div class="ttname"><a href="server__old_8h.html#a52b6e82944b6ee741486f9c2567bd9b9">client_state_t</a></div><div class="ttdeci">client_state_t</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00088">server_old.h:88</a></div></div>
<div class="ttc" id="aserver__old_8h_html_a7bfebc8e763f36d1870198931d6b5eb1"><div class="ttname"><a href="server__old_8h.html#a7bfebc8e763f36d1870198931d6b5eb1">client_t</a></div><div class="ttdeci">struct client_s client_t</div></div>
<div class="ttc" id="aserver__old_8h_html_aab1a0d6f90722c03ed6c8a9460d6e792"><div class="ttname"><a href="server__old_8h.html#aab1a0d6f90722c03ed6c8a9460d6e792">CMD_MAX</a></div><div class="ttdeci">#define CMD_MAX</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00041">server_old.h:41</a></div></div>
<div class="ttc" id="astructcircular__buffer__s_html"><div class="ttname"><a href="structcircular__buffer__s.html">circular_buffer_s</a></div><div class="ttdoc">Circular buffer for efficient I/O.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00101">server_old.h:101</a></div></div>
<div class="ttc" id="astructcommand__queue__s_html"><div class="ttname"><a href="structcommand__queue__s.html">command_queue_s</a></div><div class="ttdoc">Command queue for client commands.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00116">server_old.h:116</a></div></div>
<div class="ttc" id="astructplayer__s_html"><div class="ttname"><a href="structplayer__s.html">player_s</a></div><div class="ttdoc">Player entity.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00139">server_old.h:139</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md6"></a>
Gestion du temps et des événements</h1>
<h2><a class="anchor" id="autotoc_md7"></a>
Concept temporel</h2>
<div class="fragment"><div class="line">Temps réel ─────&gt; Time Units ─────&gt; Actions</div>
<div class="line">   (ms)            (1/f sec)         (durée)</div>
<div class="line"> </div>
<div class="line">Example avec f=100:</div>
<div class="line">- 1 time unit = 10ms</div>
<div class="line">- Action &quot;Forward&quot; = 7 time units = 70ms</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md8"></a>
Event Queue</h2>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_struct" href="structevent__s.html">event_s</a> {</div>
<div class="line">    uint64_t <a class="code hl_variable" href="group__player.html#ga98600342018b317862942b09e5fcd4b1">execute_at</a>;          <span class="comment">// Timestamp d&#39;exécution</span></div>
<div class="line">    event_type_t type;            <span class="comment">// Type d&#39;événement</span></div>
<div class="line">    <span class="keywordtype">void</span> *data;                   <span class="comment">// Données associées</span></div>
<div class="line">    event_handler_t handler;      <span class="comment">// Fonction à appeler</span></div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="structevent__s.html">event_s</a> *<a class="code hl_variable" href="group__player.html#ga401ea36ec298a36fb59875723a44b0c6">next</a>;         <span class="comment">// Liste chaînée triée</span></div>
<div class="line">} <a class="code hl_typedef" href="server__old_8h.html#ada2c77252a33c839a00748f3e7e96bcb">event_t</a>;</div>
<div class="ttc" id="agroup__player_html_ga401ea36ec298a36fb59875723a44b0c6"><div class="ttname"><a href="group__player.html#ga401ea36ec298a36fb59875723a44b0c6">event_s::next</a></div><div class="ttdeci">struct event_s * next</div><div class="ttdoc">Next event in queue.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00187">server_old.h:187</a></div></div>
<div class="ttc" id="agroup__player_html_ga98600342018b317862942b09e5fcd4b1"><div class="ttname"><a href="group__player.html#ga98600342018b317862942b09e5fcd4b1">event_s::execute_at</a></div><div class="ttdeci">uint64_t execute_at</div><div class="ttdoc">Execution timestamp.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00184">server_old.h:184</a></div></div>
<div class="ttc" id="aserver__old_8h_html_ada2c77252a33c839a00748f3e7e96bcb"><div class="ttname"><a href="server__old_8h.html#ada2c77252a33c839a00748f3e7e96bcb">event_t</a></div><div class="ttdeci">struct event_s event_t</div></div>
<div class="ttc" id="astructevent__s_html"><div class="ttname"><a href="structevent__s.html">event_s</a></div><div class="ttdoc">Timed event.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00183">server_old.h:183</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md9"></a>
Flow d'exécution</h2>
<div class="fragment"><div class="line">1. Client envoie commande</div>
<div class="line">2. Validation et parsing</div>
<div class="line">3. Calcul du temps d&#39;exécution</div>
<div class="line">4. Ajout à l&#39;event queue</div>
<div class="line">5. Poll avec timeout jusqu&#39;au prochain event</div>
<div class="line">6. Exécution de l&#39;event</div>
<div class="line">7. Envoi de la réponse</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md10"></a>
Module Network</h1>
<h2><a class="anchor" id="autotoc_md11"></a>
Buffer circulaire</h2>
<div class="fragment"><div class="line">┌─────────────────────────────────────┐</div>
<div class="line">│                                     │</div>
<div class="line">│  [────DONNÉES────]        [ESPACE]  │</div>
<div class="line">│   ^              ^        ^         │</div>
<div class="line">│   read_pos       write_pos          │</div>
<div class="line">└─────────────────────────────────────┘</div>
</div><!-- fragment --><p><b>Avantages:</b></p><ul>
<li>Pas de memmove nécessaire</li>
<li>Taille fixe (pas de realloc)</li>
<li>Gestion simple du wrap-around</li>
</ul>
<h2><a class="anchor" id="autotoc_md12"></a>
Gestion des commandes</h2>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_struct" href="structcommand__s.html">command_s</a> {</div>
<div class="line">    <span class="keywordtype">char</span> <a class="code hl_variable" href="group__player.html#ga6564650ab84b6ba6a92e92fdfeb9d3f0">data</a>[<a class="code hl_define" href="server__old_8h.html#aab1a0d6f90722c03ed6c8a9460d6e792">CMD_MAX</a>];           <span class="comment">// Commande complète</span></div>
<div class="line">    <span class="keywordtype">size_t</span> <a class="code hl_variable" href="group__player.html#gace3a8d9c7265ff1693451aad57d856e0">len</a>;                   </div>
<div class="line">    uint64_t <a class="code hl_variable" href="group__player.html#gaa98c69afd1bd860ab9c3ab9f12334054">received_at</a>;         <span class="comment">// Pour debug/stats</span></div>
<div class="line">    <span class="keyword">struct </span><a class="code hl_struct" href="structcommand__s.html">command_s</a> *<a class="code hl_variable" href="group__player.html#ga2e0d0ef257ca76880cf1fb7e97d8ad33">next</a>;       </div>
<div class="line">} <a class="code hl_typedef" href="server__old_8h.html#a2503500589735c0460a39f66f4f9157f">command_t</a>;</div>
<div class="ttc" id="agroup__player_html_ga2e0d0ef257ca76880cf1fb7e97d8ad33"><div class="ttname"><a href="group__player.html#ga2e0d0ef257ca76880cf1fb7e97d8ad33">command_s::next</a></div><div class="ttdeci">struct command_s * next</div><div class="ttdoc">Next command in queue.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00113">server_old.h:113</a></div></div>
<div class="ttc" id="agroup__player_html_ga6564650ab84b6ba6a92e92fdfeb9d3f0"><div class="ttname"><a href="group__player.html#ga6564650ab84b6ba6a92e92fdfeb9d3f0">command_s::data</a></div><div class="ttdeci">char data[CMD_MAX]</div><div class="ttdoc">Command text.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00110">server_old.h:110</a></div></div>
<div class="ttc" id="agroup__player_html_gaa98c69afd1bd860ab9c3ab9f12334054"><div class="ttname"><a href="group__player.html#gaa98c69afd1bd860ab9c3ab9f12334054">command_s::received_at</a></div><div class="ttdeci">uint64_t received_at</div><div class="ttdoc">Reception timestamp.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00112">server_old.h:112</a></div></div>
<div class="ttc" id="agroup__player_html_gace3a8d9c7265ff1693451aad57d856e0"><div class="ttname"><a href="group__player.html#gace3a8d9c7265ff1693451aad57d856e0">command_s::len</a></div><div class="ttdeci">size_t len</div><div class="ttdoc">Command length.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00111">server_old.h:111</a></div></div>
<div class="ttc" id="aserver__old_8h_html_a2503500589735c0460a39f66f4f9157f"><div class="ttname"><a href="server__old_8h.html#a2503500589735c0460a39f66f4f9157f">command_t</a></div><div class="ttdeci">struct command_s command_t</div></div>
<div class="ttc" id="astructcommand__s_html"><div class="ttname"><a href="structcommand__s.html">command_s</a></div><div class="ttdoc">Individual command structure.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00109">server_old.h:109</a></div></div>
</div><!-- fragment --><p><b>Limite de 10 commandes:</b></p><ul>
<li>Si queue pleine, drop la nouvelle commande</li>
<li>Envoyer "ko" au client</li>
<li>Logger l'événement</li>
</ul>
<h1><a class="anchor" id="autotoc_md13"></a>
Module World</h1>
<h2><a class="anchor" id="autotoc_md14"></a>
Map toroïdale</h2>
<div class="fragment"><div class="line">Coordonnées (x, y):</div>
<div class="line">- real_x = x % map_width</div>
<div class="line">- real_y = y % map_height</div>
<div class="line">- Si x &lt; 0: real_x = map_width + (x % map_width)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md15"></a>
Tile structure</h2>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_struct" href="structtile__s.html">tile_s</a> {</div>
<div class="line">    <span class="comment">/* Position */</span></div>
<div class="line">    <span class="keywordtype">int</span> <a class="code hl_variable" href="group__player.html#gac4ead0f2ed33fef5c69aff5c12a86ab2">x</a>, <a class="code hl_variable" href="group__player.html#gaf13755adef426abc549e4213e9b265bd">y</a>;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* Contenu */</span></div>
<div class="line">    resource_list_t *<a class="code hl_variable" href="group__player.html#ga4b71816422fd1214ad7c3718756d4dd6">resources</a>;   <span class="comment">// Liste de ressources</span></div>
<div class="line">    player_list_t *<a class="code hl_variable" href="group__player.html#ga5c9175da85be7844f8dca2f77df4e4f5">players</a>;       <span class="comment">// Liste de joueurs</span></div>
<div class="line">    egg_list_t *<a class="code hl_variable" href="group__player.html#ga7d8945a6e3e9f59b63fa51167e53c2ce">eggs</a>;            <span class="comment">// Liste d&#39;œufs</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* Optimisation */</span></div>
<div class="line">    uint32_t <a class="code hl_variable" href="group__player.html#ga000883b728e83695a98d85afc0764cd6">resource_count</a>[RESOURCE_MAX];</div>
<div class="line">    uint32_t total_resources;</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_variable" href="group__player.html#ga5340b3d0029efbc2e884e44c10226268">dirty</a>;                   <span class="comment">// Pour GUI updates</span></div>
<div class="line">} <a class="code hl_typedef" href="server__old_8h.html#acfbbe351623fe42374f0c07f8fee8d10">tile_t</a>;</div>
<div class="ttc" id="agroup__player_html_ga000883b728e83695a98d85afc0764cd6"><div class="ttname"><a href="group__player.html#ga000883b728e83695a98d85afc0764cd6">tile_s::resource_count</a></div><div class="ttdeci">int resource_count[RESOURCE_TYPES]</div><div class="ttdoc">Count by type.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00162">server_old.h:162</a></div></div>
<div class="ttc" id="agroup__player_html_ga4b71816422fd1214ad7c3718756d4dd6"><div class="ttname"><a href="group__player.html#ga4b71816422fd1214ad7c3718756d4dd6">tile_s::resources</a></div><div class="ttdeci">resource_t * resources</div><div class="ttdoc">Resources on this tile.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00159">server_old.h:159</a></div></div>
<div class="ttc" id="agroup__player_html_ga5340b3d0029efbc2e884e44c10226268"><div class="ttname"><a href="group__player.html#ga5340b3d0029efbc2e884e44c10226268">tile_s::dirty</a></div><div class="ttdeci">bool dirty</div><div class="ttdoc">Needs GUI update.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00163">server_old.h:163</a></div></div>
<div class="ttc" id="agroup__player_html_ga5c9175da85be7844f8dca2f77df4e4f5"><div class="ttname"><a href="group__player.html#ga5c9175da85be7844f8dca2f77df4e4f5">tile_s::players</a></div><div class="ttdeci">player_t * players</div><div class="ttdoc">Players on this tile.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00160">server_old.h:160</a></div></div>
<div class="ttc" id="agroup__player_html_ga7d8945a6e3e9f59b63fa51167e53c2ce"><div class="ttname"><a href="group__player.html#ga7d8945a6e3e9f59b63fa51167e53c2ce">tile_s::eggs</a></div><div class="ttdeci">egg_t * eggs</div><div class="ttdoc">Eggs on this tile.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00161">server_old.h:161</a></div></div>
<div class="ttc" id="agroup__player_html_gac4ead0f2ed33fef5c69aff5c12a86ab2"><div class="ttname"><a href="group__player.html#gac4ead0f2ed33fef5c69aff5c12a86ab2">tile_s::x</a></div><div class="ttdeci">int x</div><div class="ttdoc">X coordinate.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00157">server_old.h:157</a></div></div>
<div class="ttc" id="agroup__player_html_gaf13755adef426abc549e4213e9b265bd"><div class="ttname"><a href="group__player.html#gaf13755adef426abc549e4213e9b265bd">tile_s::y</a></div><div class="ttdeci">int y</div><div class="ttdoc">Y coordinate.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00158">server_old.h:158</a></div></div>
<div class="ttc" id="aserver__old_8h_html_acfbbe351623fe42374f0c07f8fee8d10"><div class="ttname"><a href="server__old_8h.html#acfbbe351623fe42374f0c07f8fee8d10">tile_t</a></div><div class="ttdeci">struct tile_s tile_t</div></div>
<div class="ttc" id="astructtile__s_html"><div class="ttname"><a href="structtile__s.html">tile_s</a></div><div class="ttdoc">Map tile.</div><div class="ttdef"><b>Definition</b> <a href="server__old_8h_source.html#l00156">server_old.h:156</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md16"></a>
Spawn des ressources</h2>
<p><b>Algorithme de distribution:</b></p><ol type="1">
<li>Calculer quantité totale: <code>width * height * density</code></li>
<li>S'assurer qu'il y a au moins 1 de chaque ressource</li>
<li>Distribuer aléatoirement mais uniformément</li>
<li>Re-spawn toutes les 20 time units</li>
</ol>
<h1><a class="anchor" id="autotoc_md17"></a>
Module Game</h1>
<h2><a class="anchor" id="autotoc_md18"></a>
Système d'élévation</h2>
<p><b>Vérifications:</b></p><ol type="1">
<li>Au début: Vérifier ressources + joueurs requis</li>
<li>Pendant: Freeze tous les participants</li>
<li>À la fin: Re-vérifier les conditions</li>
<li>Si succès: Consommer ressources, level up</li>
<li>Si échec: Unfreeze sans effet</li>
</ol>
<h2><a class="anchor" id="autotoc_md19"></a>
Gestion des œufs</h2>
<div class="fragment"><div class="line">Fork ──&gt; Create Egg ──&gt; Add to tile ──&gt; Wait for connection</div>
<div class="line">                           │</div>
<div class="line">                           ▼</div>
<div class="line">                    Client connects ──&gt; Hatch ──&gt; Spawn player</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md20"></a>
Optimisations importantes</h1>
<h2><a class="anchor" id="autotoc_md21"></a>
1. Spatial indexing</h2>
<ul>
<li>Diviser la map en régions pour broadcasts</li>
<li>Cache de vision par niveau</li>
<li>Dirty flags pour GUI updates</li>
</ul>
<h2><a class="anchor" id="autotoc_md22"></a>
2. Memory pools</h2>
<div class="fragment"><div class="line"><span class="comment">// Au lieu de malloc/free fréquents</span></div>
<div class="line"><a class="code hl_struct" href="structplayer__s.html">player_t</a> *player = pool_alloc(server-&gt;player_pool);</div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line">pool_free(server-&gt;player_pool, player);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md23"></a>
3. Zero-copy networking</h2>
<ul>
<li>Utiliser <code>writev()</code> pour envoyer plusieurs buffers</li>
<li>Éviter les copies inutiles</li>
<li>Direct pointer dans circular buffer</li>
</ul>
<h2><a class="anchor" id="autotoc_md24"></a>
4. Time management</h2>
<ul>
<li>Utiliser <code>clock_gettime(CLOCK_MONOTONIC)</code></li>
<li>Calculer timeout dynamiquement</li>
<li>Batch les events proches</li>
</ul>
<h1><a class="anchor" id="autotoc_md25"></a>
Gestion des erreurs</h1>
<h2><a class="anchor" id="autotoc_md26"></a>
Hiérarchie d'erreurs</h2>
<div class="fragment"><div class="line">CRITICAL ──&gt; Arrêt du serveur</div>
<div class="line">ERROR ────&gt; Log + recovery</div>
<div class="line">WARNING ──&gt; Log + continue</div>
<div class="line">INFO ─────&gt; Log si verbose</div>
<div class="line">DEBUG ────&gt; Log si debug mode</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md27"></a>
Recovery patterns</h2>
<div class="fragment"><div class="line"><span class="comment">// Pattern goto cleanup</span></div>
<div class="line">error_code_t handle_client_command(<a class="code hl_struct" href="structclient__s.html">client_t</a> *client) {</div>
<div class="line">    error_code_t ret = ERR_NONE;</div>
<div class="line">    <a class="code hl_struct" href="structcommand__s.html">command_t</a> *cmd = NULL;</div>
<div class="line">    </div>
<div class="line">    cmd = parse_command(client);</div>
<div class="line">    <span class="keywordflow">if</span> (!cmd) {</div>
<div class="line">        ret = ERR_PARSE;</div>
<div class="line">        <span class="keywordflow">goto</span> cleanup;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// ... traitement ...</span></div>
<div class="line">    </div>
<div class="line">cleanup:</div>
<div class="line">    <span class="keywordflow">if</span> (cmd) command_free(cmd);</div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md28"></a>
Points d'attention critiques</h1>
<h2><a class="anchor" id="autotoc_md29"></a>
1. Thread safety</h2>
<ul>
<li><b>Rappel</b>: Single-threaded !</li>
<li>Pas de mutex nécessaire</li>
<li>Attention aux callbacks qui modifient l'état</li>
</ul>
<h2><a class="anchor" id="autotoc_md30"></a>
2. Integer overflow</h2>
<ul>
<li>Vérifier les calculs de temps</li>
<li>Utiliser des types appropriés (uint64_t pour timestamps)</li>
<li>Saturer plutôt qu'overflow</li>
</ul>
<h2><a class="anchor" id="autotoc_md31"></a>
3. Resource leaks</h2>
<ul>
<li>Valgrind obligatoire</li>
<li>Cleanup handlers pour chaque module</li>
<li>Atexit pour cleanup global</li>
</ul>
<h2><a class="anchor" id="autotoc_md32"></a>
4. Network edge cases</h2>
<ul>
<li>Client qui déconnecte pendant une action</li>
<li>Partial writes (EAGAIN)</li>
<li>Broken pipe (SIGPIPE)</li>
</ul>
<h1><a class="anchor" id="autotoc_md33"></a>
Tests spécifiques serveur</h1>
<h2><a class="anchor" id="autotoc_md34"></a>
Tests unitaires</h2>
<ul>
<li>Test de chaque module isolément</li>
<li>Mock des dépendances</li>
<li>Couverture des cas d'erreur</li>
</ul>
<h2><a class="anchor" id="autotoc_md35"></a>
Tests d'intégration</h2>
<ul>
<li>Scénarios complets de jeu</li>
<li>Multiple clients</li>
<li>Conditions de course</li>
</ul>
<h2><a class="anchor" id="autotoc_md36"></a>
Tests de stress</h2>
<ul>
<li>100+ clients simultanés</li>
<li>Commandes en rafale</li>
<li>Déconnexions/reconnexions</li>
</ul>
<h2><a class="anchor" id="autotoc_md37"></a>
Tests de robustesse</h2>
<ul>
<li>Fuzzing des entrées</li>
<li>Mémoire limitée</li>
<li>CPU throttling</li>
</ul>
<h1><a class="anchor" id="autotoc_md38"></a>
Debugging et monitoring</h1>
<h2><a class="anchor" id="autotoc_md39"></a>
Logs structurés</h2>
<div class="fragment"><div class="line">[TIMESTAMP] [LEVEL] [MODULE] Message</div>
<div class="line">2024-03-14 10:23:45.123 [INFO] [GAME] Player 42 reached level 3</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md40"></a>
Métriques importantes</h2>
<ul>
<li>Latence par commande</li>
<li>Utilisation mémoire</li>
<li>Nombre de clients actifs</li>
<li>Events par seconde</li>
</ul>
<h2><a class="anchor" id="autotoc_md41"></a>
Debug mode</h2>
<ul>
<li>Dump de l'état du monde</li>
<li>Trace des commandes</li>
<li>Statistiques détaillées</li>
</ul>
<h1><a class="anchor" id="autotoc_md42"></a>
Checklist de développement</h1>
<ul>
<li>[ ] Parser d'arguments robuste</li>
<li>[ ] Initialisation des sockets</li>
<li>[ ] Poll loop avec timeout dynamique</li>
<li>[ ] Circular buffers pour I/O</li>
<li>[ ] Parsing incrémental des commandes</li>
<li>[ ] Event queue avec priority</li>
<li>[ ] Map toroïdale</li>
<li>[ ] Spawn/respawn des ressources</li>
<li>[ ] Système d'élévation complet</li>
<li>[ ] Gestion des œufs</li>
<li>[ ] Memory pools</li>
<li>[ ] Cleanup propre</li>
<li>[ ] Tests complets</li>
<li>[ ] Documentation </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
